<?phpdefined('BASEPATH') OR exit('No direct script access allowed');class Firmas_circuitos_model extends MY_Model{	public function __construct()	{		parent::__construct();		$this->table_name = "firmas_circuitos";		$this->msg_name = 'Firma Circuito';		$this->id_name = 'id';		$this->columnas = array('id', 'circuito_id', 'orden', 'cargo_id');		$this->fields = array(			array('name' => 'orden', 'label' => 'Orden', 'type' => 'integer', 'maxlength' => '10', 'required' => TRUE),			array('name' => 'cargo', 'label' => 'Cargo', 'input_type' => 'combo', 'id_name' => 'cargo_id', 'required' => TRUE)		);		$this->requeridos = array('circuito_id', 'orden', 'cargo_id');		//$this->unicos = array();	}	/**	 * _can_delete: Devuelve true si puede eliminarse el registro.	 *	 * @param int $delete_id	 * @return bool	 */	protected function _can_delete($delete_id)	{		return TRUE;	}	public function get_siguiente_orden($circuito_id)	{		return $this->db->select('COALESCE(MAX(orden),0)+1 as orden')->from('firmas_circuitos')->where('circuito_id', $circuito_id)->get()->row()->orden;	}	public function operacion($firma_circuito, $operacion)	{		$circuito = $this->db->select('c.*, min(orden) as min_orden, max(orden) as max_orden')				->from('circuitos c')->join('firmas_circuitos fc', 'fc.circuito_id=c.id')->where('c.id', $firma_circuito->circuito_id)->group_by('c.id')->get()->row();		if (empty($circuito))		{			$this->_set_error('No se encuentra el circuito');			return FALSE;		}		else		{			switch ($operacion)			{				case 'del':					$this->db->delete('firmas_circuitos', array('id' => $firma_circuito->id));					if ($firma_circuito->orden < $circuito->max_orden)					{						$this->db->set('orden', 'orden-1', FALSE)							->where('circuito_id', $circuito->id)							->where('orden >', $firma_circuito->orden)							->update('firmas_circuitos');					}					break;				case 'up':					if ($firma_circuito->orden > 1)					{						$this->db->set('orden', 'orden+1', FALSE)							->where('circuito_id', $circuito->id)							->where('orden', $firma_circuito->orden - 1)							->update('firmas_circuitos');						$this->db->update('firmas_circuitos', array('orden' => $firma_circuito->orden - 1), array('id' => $firma_circuito->id));					}					break;				case 'down':					if ($firma_circuito->orden < $circuito->max_orden)					{						$this->db->set('orden', 'orden-1', FALSE)							->where('circuito_id', $circuito->id)							->where('orden', $firma_circuito->orden + 1)							->update('firmas_circuitos');						$this->db->update('firmas_circuitos', array('orden' => $firma_circuito->orden + 1), array('id' => $firma_circuito->id));					}					break;				default:					break;			}			return TRUE;		}	}}/* End of file Firmas_circuitos_model.php *//* Location: ./application/modules/expedientes/models/Firmas_circuitos_model.php */